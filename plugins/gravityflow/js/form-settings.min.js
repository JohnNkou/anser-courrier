!function(k,b){"use strict";function v(t,e){var i=b("#gform-setting-tab-field-"+e+"_notification_type");(i.toggle(t),t)?(o(i.find("input[type=radio]:checked").val(),e),b("#gform-setting-tab-tab_"+e+"_notification i.gravityflow-tab-checked").show(),b("#gform-setting-tab-tab_"+e+"_notification i.gravityflow-tab-unchecked").hide()):(o("off",e),b("#gform-setting-tab-tab_"+e+"_notification i.gravityflow-tab-checked").hide(),b("#gform-setting-tab-tab_"+e+"_notification i.gravityflow-tab-unchecked").show())}function o(i,t){var e=["users","routing","from_name","from_email","reply_to","cc","bcc","subject","message","autoformat","resend","gpdf"],o="#gform-setting-tab-field-"+t+"_notification_";b.each(e,function(t,e){b(o+e).hide()}),"off"!=i&&b.each(e,function(t,e){if("users"==e&&"routing"==i||"routing"==e&&"select"==i)return!0;b(o+e).fadeToggle("normal")})}function h(t){e({select:["workflow_notification_users_","workflow_notification_from_name","workflow_notification_from_email","workflow_notification_reply_to","workflow_notification_cc","workflow_notification_bcc","workflow_notification_subject","workflow_notification_message","workflow_notification_autoformat","workflow_email_custom_file_name","workflow_notification_gpdf"],routing:["workflow_notification_routing","workflow_notification_from_name","workflow_notification_from_email","workflow_notification_reply_to","workflow_notification_cc","workflow_notification_bcc","workflow_notification_subject","workflow_notification_message","workflow_notification_autoformat","workflow_email_custom_file_name","workflow_notification_gpdf"]},t,!1)}function y(t){e({select:["assignees_","editable_fields_","conditional_logic_editable_fields_enabled"],routing:["routing","conditional_logic_editable_fields_enabled"]},t)}function e(t,i,e){var o=e?"#gform-setting-tab-field-":"#gform_setting_";b.each(t,function(t,e){b.each(e,function(t,e){b(o+e).hide()})}),b.each(t,function(t,e){i==t&&b.each(e,function(t,e){b(o+e).fadeToggle("normal")})})}function j(t){var e=b("#gform_setting_workflow_notification_type");(e.toggle(t),t)?h(e.find("input[type=radio]:checked").val()):h("off")}b(document).ready(function(){b("#editable_fields, .gravityflow-multiselect-ui").multiSelect();var s={selectableHeader:"<input type='text' class='search-input' autocomplete='off' placeholder='"+gravityflow_form_settings_js_strings.assigneeSearchPlaceholder+"'>",selectionHeader:"<input type='text' class='search-input' autocomplete='off' placeholder='"+gravityflow_form_settings_js_strings.assigneeSearchPlaceholder+"'>",afterInit:function(t){var e=this,i=e.$selectableUl.prev(),o=e.$selectionUl.prev(),n="#"+t.attr("id")+" .ms-elem-selectable:not(.ms-selected)",a="#"+t.attr("id")+" .ms-elem-selection.ms-selected";10<b("#"+t.attr("id")+" .ms-elem-selectable").length&&b(".ms-container .search-input").show(),e.qs1=i.quicksearch(n).on("keydown",function(t){if(40===t.which)return e.$selectableUl.focus(),!1}),e.qs2=o.quicksearch(a).on("keydown",function(t){if(40==t.which)return e.$selectionUl.focus(),!1})},afterSelect:function(){this.qs1.cache(),this.qs2.cache()},afterDeselect:function(){this.qs1.cache(),this.qs2.cache()}};b("#assignees, #workflow_notification_users").multiSelect(s);var t=!1,e=!1;b("form#gform-settings").submit(function(){e=!0,b("form#gform-settings").find(":input").removeAttr("disabled")}),b(":input").change(function(){t=!0}),window.onbeforeunload=function(){if(t&&!e)return"You have unsaved changes."};b("input[name=_gform_setting_step_type]:checked").val();var i=b("#status_expiration"),o="expired"==i.val();b("#expiration_sub_setting_destination_expired").toggle(o),i.change(function(){"expired"==b(this).val()?b("#expiration_sub_setting_destination_expired").show():b("#expiration_sub_setting_destination_expired").hide()}),function(){for(var t=["routing","assignees_","assignee_notification_from_name","assignee_notification_from_email","assignee_notification_reply_to","assignee_notification_cc","assignee_notification_bcc","assignee_notification_subject","assignee_notification_message","assignee_notification_autoformat","resend_assignee_email","assignee_notification_gpdf","rejection_notification_type","rejection_notification_users_","rejection_notification_user_field","rejection_notification_routing","rejection_notification_message","rejection_notification_autoformat","approval_notification_type","approval_notification_users_","approval_notification_user_field","approval_notification_routing","approval_notification_message","approval_notification_autoformat","workflow_notification_type","workflow_notification_users_","workflow_notification_user_field","workflow_notification_routing","workflow_notification_from_name","workflow_notification_from_email","workflow_notification_reply_to","workflow_notification_cc","workflow_notification_bcc","workflow_notification_subject","workflow_notification_message","workflow_notification_autoformat","assignees","editable_fields_","routing","assignee_notification_message","workflow_notification_gpdf"],e=0;e<t.length;e++)b("#gform_setting_"+t[e]).addClass("gravityflow_sub_setting")}();var n=b("input[name=_gform_setting_type]:checked");y(n.length?n.val():"select"),b("#gform_setting_type input[type=radio]").change(function(){y(this.value)}),k.getUsersMarkup=function(t){var e,i,o,n=gf_routing_setting_strings.accounts,a='<select class="gform-routing-users '+t+'_{i}">';for(e=0;e<n.length;e++)if(void 0!==(o=n[e]).choices){var r,s="";for(i=0;i<o.choices.length;i++)r=o.choices[i],s+='<option value="{0}">{1}</option>'.format(r.value,r.label);a+='<optgroup label="{0}">{1}</option>'.format(o.label,s)}else a+='<option value="{0}">{1}</option>'.format(o.value,o.label);return a+="</select>"};var a,r=b("#gform_routing_setting"),_=b("#routing").val(),l=_?b.parseJSON(_):null;a=0<b("#editable_fields").length?(l||(l=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,editable_fields:[gf_routing_setting_strings.input_fields[0].key],fieldId:"0",operator:"is",value:"",type:""}],b("#user_input_routing").val(b.toJSON(l))),l.forEach(function(t){void 0===t.editable_fields&&(t.editable_fields=[])}),{fieldName:r.data("field_name"),fieldId:r.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:l,callbacks:{addNewTarget:function(t,e){var i=k.getUsersMarkup("assignee"),o=b("#editable_fields").clone();o.attr("name","editable_fields");b("#gform-routings tbody tr").length;return o.attr("id","editable_fields_routing_{i}"),o.attr("style",""),o.addClass("gform-routing-input-field editable_fields_{i}"),i+="</td><td>"+o[0].outerHTML},header:function(t,e){return'<thead><tr><th>Assign To</th><th>Editable Fields</th><th colspan="3">Condition</th></tr></thead>'}}}):(l||(l=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,fieldId:"0",operator:"is",value:"",type:""}],b("#routing").val(b.toJSON(l))),{fieldName:r.data("field_name"),fieldId:r.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:l,callbacks:{addNewTarget:function(t,e){return k.getUsersMarkup("assignee")}}}),r.gfRoutingSetting(a),b("#gform_setting_workflow_notification_type input[type=radio]").click(function(){h(this.value)}),j(b("#workflow_notification_enabled").prop("checked")),b("#workflow_notification_enabled").click(function(){j(this.checked)});var f=b("#gform_user_routing_setting_workflow_notification_routing"),g=b("#workflow_notification_routing").val(),c=g?b.parseJSON(g):null;c||(c=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,fieldId:"0",operator:"is",value:"",type:""}],b("#workflow_notification_routing").val(b.toJSON(c)));var u={fieldName:f.data("field_name"),fieldId:f.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:c,callbacks:{addNewTarget:function(t,e){return k.getUsersMarkup("assignee")}}};f.gfRoutingSetting(u),k.initNotificationTab=function(t){b("#"+t+"_notification_users").multiSelect(s);var e=b("#"+t+"_notification_enabled");v(e.prop("checked"),t),e.click(function(){v(this.checked,t)}),b("#gform-setting-tab-field-"+t+"_notification_type input[type=radio]").click(function(){v(!0,t)});var i=b("#gform_user_routing_setting_"+t+"_notification_routing");if(i.length){var o=b("#"+t+"_notification_routing"),n=o.val(),a=n?b.parseJSON(n):null;a||(a=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,fieldId:"0",operator:"is",value:"",type:""}],o.val(b.toJSON(a)));var r={fieldName:i.data("field_name"),fieldId:i.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:a,callbacks:{addNewTarget:function(t,e){return k.getUsersMarkup("assignee")}}};i.gfRoutingSetting(r)}};for(var w=["assignee","rejection","approval","in_progress","complete","revert"],d=0;d<w.length;d++)k.initNotificationTab(w[d]);var p=b("#default_status");"hidden"===p.val()&&b("#tabs-notification_tabs").tabs("disable",1),p.change(function(){var t="hidden"===b(this).val(),e=b("#tabs-notification_tabs");if(t){var i=b("#in_progress_notification_enabled");i.prop("checked")&&i.click(),1===e.tabs("option","active")&&e.tabs("option","active",0),e.tabs("disable",1)}else e.tabs("enable",1)});var m=b("#revertenable");m.prop("checked")||(b("#tabs-notification_tabs").tabs("disable",3),b("#gform_setting_reverted_message").hide()),m.change(function(){var t=b(this).prop("checked"),e=b("#tabs-notification_tabs");if(t)e.tabs("enable",3),b("#gform_setting_reverted_message").show();else{var i=b("#revert_notification_enabled");i.prop("checked")&&i.click(),1===e.tabs("option","active")&&e.tabs("option","active",0),e.tabs("disable",3),b("#gform_setting_reverted_message").hide()}}),window.gform&&gform.addFilter("gform_merge_tags",k.gravityflow_add_merge_tags),window.gformInitDatepicker&&gformInitDatepicker(),function(){var t=gravityflow_form_settings_js_strings.feedId;if(0<t){var e=ajaxurl+"?action=gravityflow_feed_message&fid="+t+"&id="+gravityflow_form_settings_js_strings.formId;b.get(e,function(t){var e=b("#gform-settings-save");e.before(t)})}}()}),k.gravityflow_add_merge_tags=function(t,e,i,o,n,a){return n||(function(t,e,i,o,n,a){if(["_gform_setting_assignee_notification_message","_gform_setting_approval_notification_message","_gform_setting_approved_messageValue","_gform_setting_confirmation_messageValue","_gform_setting_complete_notification_message","_gform_setting_instructionsValue","_gform_setting_in_progress_notification_message","_gform_setting_processed_step_messageValue","_gform_setting_rejected_messageValue","_gform_setting_rejection_notification_message","_gform_setting_reverted_messageValue","_gform_setting_revert_notification_message","_gform_setting_workflow_notification_message"].indexOf(e)<0)return;var r=gravityflow_form_settings_js_strings.mergeTagLabels,s=[];s.push({tag:"{workflow_entry_link}",label:r.workflow_entry_link}),s.push({tag:"{workflow_entry_url}",label:r.workflow_entry_url}),s.push({tag:"{workflow_inbox_link}",label:r.workflow_inbox_link}),s.push({tag:"{workflow_inbox_url}",label:r.workflow_inbox_url}),s.push({tag:"{workflow_cancel_link}",label:r.workflow_cancel_link}),s.push({tag:"{workflow_cancel_url}",label:r.workflow_cancel_url}),s.push({tag:"{workflow_note}",label:r.workflow_note}),s.push({tag:"{workflow_timeline}",label:r.workflow_timeline}),s.push({tag:"{assignees}",label:r.assignees}),t.gravityflow={label:r.group,tags:s}}(t,e),function(t,e,i,o,n,a){if(["_gform_setting_assignee_notification_message"].indexOf(e)<0)return;var r=gravityflow_form_settings_js_strings.mergeTagLabels,s=[];s.push({tag:"{workflow_approve_link}",label:r.workflow_approve_link}),s.push({tag:"{workflow_approve_url}",label:r.workflow_approve_url}),s.push({tag:"{workflow_approve_token}",label:r.workflow_approve_token}),s.push({tag:"{workflow_reject_link}",label:r.workflow_reject_link}),s.push({tag:"{workflow_reject_url}",label:r.workflow_reject_url}),s.push({tag:"{workflow_reject_token}",label:r.workflow_reject_token}),b("#revertenable").prop("checked")&&(s.push({tag:"{workflow_revert_link}",label:r.workflow_revert_link}),s.push({tag:"{workflow_revert_url}",label:r.workflow_revert_url}),s.push({tag:"{workflow_revert_token}",label:r.workflow_revert_token}));void 0!==t.gravityflow?t.gravityflow.tags=b.merge(t.gravityflow.tags,s):t.gravityflow={label:r.group,tags:s}}(t,e),function(t,e,i,o,n,a){if(["approval_notification_subject","assignee_notification_subject","workflow_notification_subject","complete_notification_subject"].indexOf(e)<0)return;var r=gravityflow_form_settings_js_strings.mergeTagLabels,s=[];s.push({tag:"{assignees}",label:r.assignees}),s.push({tag:"{current_step}",label:r.current_step}),s.push({tag:"{workflow_note}",label:r.workflow_note}),s.push({tag:"{workflow_entry_url}",label:r.workflow_entry_url}),s.push({tag:"{workflow_inbox_url}",label:r.workflow_inbox_url}),s.push({tag:"{workflow_cancel_url}",label:r.workflow_cancel_url}),"assignee_notification_subject"===e&&(s.push({tag:"{workflow_approve_url}",label:r.workflow_approve_url}),s.push({tag:"{workflow_reject_url}",label:r.workflow_reject_url}));t.gravityflow={label:r.group,tags:s}}(t,e)),t}}(window.GravityFlowFeedSettings=window.GravityFlowFeedSettings||{},jQuery);